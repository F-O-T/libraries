# @f-o-t/config 1.0.0 Release Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Stabilize and clean up `@f-o-t/config` for a 1.0.0 release, fixing all existing bugs and inconsistencies.

**Architecture:** Fix the type mismatch between `ResolvedFotConfig` and the Zod schema output, align the `generatePackageJson` plugin export test with the actual monorepo convention (subdirectory pattern), add missing generator tests for biome and tsconfig, and update the README to match the real API. No new features.

**Tech Stack:** TypeScript, Zod 4, Bun test runner, bunup bundler

---

## Issues Summary

| # | Issue | Severity |
|---|-------|----------|
| 1 | `ResolvedFotConfig` uses `Required<TypeScriptOptions>` making `maxMemory: number` required, but schema outputs `number \| undefined` | Type error (blocks build) |
| 2 | `package-json.test.ts` expects flat plugin paths (`auth.js`) but implementation uses subdirectory paths (`auth/index.js`) — subdirectory is correct per monorepo convention | Failing test |
| 3 | `generatePackageJson` hardcodes `workspace:*` in devDependencies | Inconsistency (generator output doesn't match published package.json convention) |
| 4 | No tests for `generateBiomeConfig` or `generateTSConfig` generators | Missing coverage |
| 5 | README shows incorrect function signatures (generators don't take `ResolvedFotConfig` param in examples) | Docs drift |
| 6 | Tests construct `ResolvedFotConfig` objects missing `isolatedDeclarations` and `maxMemory` fields | Test type errors once types are fixed |

---

### Task 1: Fix the `ResolvedFotConfig` type mismatch

The `ResolvedFotConfig.typescript` field is typed as `Required<TypeScriptOptions>`, which makes `maxMemory` required (`number`). But `maxMemory` is intentionally optional in the schema — it defaults to `undefined`. The fix: stop using `Required<>` and explicitly define the resolved typescript type.

**Files:**
- Modify: `libraries/config/src/types.ts:87-108`

**Step 1: Update the `ResolvedFotConfig` type**

Replace the `typescript` field in `ResolvedFotConfig` from `Required<TypeScriptOptions>` to an explicit inline type:

```typescript
// In ResolvedFotConfig interface, change:
typescript: Required<TypeScriptOptions>;

// To:
typescript: {
   declaration: boolean;
   isolatedDeclarations: boolean;
   maxMemory?: number;
};
```

**Step 2: Run typecheck to verify the error is fixed**

Run: `cd /home/yorizel/Documents/fot-libraries/libraries/config && bunx tsc --noEmit`
Expected: No errors

**Step 3: Run tests to verify nothing broke**

Run: `cd /home/yorizel/Documents/fot-libraries/libraries/config && bun test`
Expected: Tests pass (the existing failing test is a separate issue)

**Step 4: Commit**

```bash
git add libraries/config/src/types.ts
git commit -m "fix(config): resolve ResolvedFotConfig type mismatch for optional maxMemory"
```

---

### Task 2: Fix the failing `generatePackageJson` plugin export test

The test at `__tests__/generators/package-json.test.ts:52-77` expects flat plugin paths like `./dist/plugins/auth.js`, but the implementation outputs `./dist/plugins/auth/index.js`. The implementation is correct — every plugin in the monorepo uses the subdirectory pattern (`src/plugins/<name>/index.ts`). The test needs updating.

**Files:**
- Modify: `libraries/config/__tests__/generators/package-json.test.ts:52-77`

**Step 1: Fix the test expectations**

Update the "should generate exports for plugins" test to expect `index.js`/`index.d.ts` paths:

```typescript
expect(pkg.exports["./plugins/auth"]).toEqual({
   types: "./dist/plugins/auth/index.d.ts",
   default: "./dist/plugins/auth/index.js",
});

expect(pkg.exports["./plugins/validation"]).toEqual({
   types: "./dist/plugins/validation/index.d.ts",
   default: "./dist/plugins/validation/index.js",
});
```

**Step 2: Run tests to verify the fix**

Run: `cd /home/yorizel/Documents/fot-libraries/libraries/config && bun test __tests__/generators/package-json.test.ts`
Expected: All tests pass, 0 failures

**Step 3: Commit**

```bash
git add libraries/config/__tests__/generators/package-json.test.ts
git commit -m "fix(config): correct plugin export path expectations in package-json test"
```

---

### Task 3: Fix test type errors for `ResolvedFotConfig` construction

After Task 1 fixes the types, existing tests that construct `ResolvedFotConfig` objects are missing `isolatedDeclarations`. Update them to include all required fields.

**Files:**
- Modify: `libraries/config/__tests__/generators/package-json.test.ts` (all `ResolvedFotConfig` objects)
- Modify: `libraries/config/__tests__/types.test.ts:69-84`

**Step 1: Update all `ResolvedFotConfig` objects in package-json test**

Every `ResolvedFotConfig` literal in this file uses `typescript: { declaration: true }`. Add `isolatedDeclarations: false`:

```typescript
typescript: { declaration: true, isolatedDeclarations: false },
```

There are 5 instances in the file (lines 9, 37, 86, 100, 73 approximately).

**Step 2: Update the `ResolvedFotConfig` object in types test**

In `__tests__/types.test.ts`, the `ResolvedFotConfig` test at line 71 also needs the field:

```typescript
const config: ResolvedFotConfig = {
   formats: ["esm"],
   external: [],
   typescript: { declaration: true, isolatedDeclarations: false },
   biome: { enabled: true },
   plugins: [],
};
```

**Step 3: Run typecheck**

Run: `cd /home/yorizel/Documents/fot-libraries/libraries/config && bunx tsc --noEmit`
Expected: No type errors

**Step 4: Run all tests**

Run: `cd /home/yorizel/Documents/fot-libraries/libraries/config && bun test`
Expected: 36 pass, 0 fail

**Step 5: Commit**

```bash
git add libraries/config/__tests__/generators/package-json.test.ts libraries/config/__tests__/types.test.ts
git commit -m "fix(config): add missing isolatedDeclarations field to test ResolvedFotConfig objects"
```

---

### Task 4: Add tests for `generateBiomeConfig`

No test file exists for the biome generator. Add one.

**Files:**
- Create: `libraries/config/__tests__/generators/biome.test.ts`

**Step 1: Write the test file**

```typescript
import { describe, expect, it } from "bun:test";
import type { ResolvedFotConfig } from "../../src/types";
import { generateBiomeConfig } from "../../src/generators/biome";

describe("generateBiomeConfig", () => {
   const baseConfig: ResolvedFotConfig = {
      formats: ["esm"],
      external: [],
      typescript: { declaration: true, isolatedDeclarations: false },
      biome: { enabled: true },
      plugins: [],
   };

   it("should generate valid biome config structure", () => {
      const biome = generateBiomeConfig(baseConfig);

      expect(biome.$schema).toBeString();
      expect(biome.vcs.enabled).toBe(true);
      expect(biome.vcs.clientKind).toBe("git");
      expect(biome.files.ignore).toContain("node_modules");
      expect(biome.files.ignore).toContain("dist");
   });

   it("should enable formatter and linter when biome is enabled", () => {
      const biome = generateBiomeConfig(baseConfig);

      expect(biome.formatter.enabled).toBe(true);
      expect(biome.linter.enabled).toBe(true);
   });

   it("should disable formatter and linter when biome is disabled", () => {
      const config: ResolvedFotConfig = {
         ...baseConfig,
         biome: { enabled: false },
      };
      const biome = generateBiomeConfig(config);

      expect(biome.formatter.enabled).toBe(false);
      expect(biome.linter.enabled).toBe(false);
   });

   it("should use tab indentation", () => {
      const biome = generateBiomeConfig(baseConfig);

      expect(biome.formatter.indentStyle).toBe("tab");
   });

   it("should use double quotes and semicolons", () => {
      const biome = generateBiomeConfig(baseConfig);

      expect(biome.javascript.formatter.quoteStyle).toBe("double");
      expect(biome.javascript.formatter.semicolons).toBe("always");
   });
});
```

**Step 2: Run test to verify it passes**

Run: `cd /home/yorizel/Documents/fot-libraries/libraries/config && bun test __tests__/generators/biome.test.ts`
Expected: 5 pass, 0 fail

**Step 3: Commit**

```bash
git add libraries/config/__tests__/generators/biome.test.ts
git commit -m "test(config): add tests for generateBiomeConfig"
```

---

### Task 5: Add tests for `generateTSConfig`

No test file exists for the tsconfig generator. Add one.

**Files:**
- Create: `libraries/config/__tests__/generators/tsconfig.test.ts`

**Step 1: Write the test file**

```typescript
import { describe, expect, it } from "bun:test";
import type { ResolvedFotConfig } from "../../src/types";
import { generateTSConfig } from "../../src/generators/tsconfig";

describe("generateTSConfig", () => {
   const baseConfig: ResolvedFotConfig = {
      formats: ["esm"],
      external: [],
      typescript: { declaration: true, isolatedDeclarations: false },
      biome: { enabled: true },
      plugins: [],
   };

   it("should generate valid tsconfig structure", () => {
      const tsconfig = generateTSConfig(baseConfig);

      expect(tsconfig.compilerOptions).toBeDefined();
      expect(tsconfig.include).toContain("src/**/*");
      expect(tsconfig.exclude).toContain("node_modules");
      expect(tsconfig.exclude).toContain("dist");
   });

   it("should respect declaration setting", () => {
      const tsconfig = generateTSConfig(baseConfig);
      expect(tsconfig.compilerOptions.declaration).toBe(true);

      const noDecl: ResolvedFotConfig = {
         ...baseConfig,
         typescript: { declaration: false, isolatedDeclarations: false },
      };
      const tsconfig2 = generateTSConfig(noDecl);
      expect(tsconfig2.compilerOptions.declaration).toBe(false);
   });

   it("should respect isolatedDeclarations setting", () => {
      const config: ResolvedFotConfig = {
         ...baseConfig,
         typescript: { declaration: true, isolatedDeclarations: true },
      };
      const tsconfig = generateTSConfig(config);

      expect(tsconfig.compilerOptions.isolatedDeclarations).toBe(true);
   });

   it("should use strict mode", () => {
      const tsconfig = generateTSConfig(baseConfig);

      expect(tsconfig.compilerOptions.strict).toBe(true);
   });

   it("should target ES2023", () => {
      const tsconfig = generateTSConfig(baseConfig);

      expect(tsconfig.compilerOptions.target).toBe("ES2023");
   });

   it("should use bundler module resolution", () => {
      const tsconfig = generateTSConfig(baseConfig);

      expect(tsconfig.compilerOptions.module).toBe("Preserve");
      expect(tsconfig.compilerOptions.moduleResolution).toBe("bundler");
   });
});
```

**Step 2: Run test to verify it passes**

Run: `cd /home/yorizel/Documents/fot-libraries/libraries/config && bun test __tests__/generators/tsconfig.test.ts`
Expected: 6 pass, 0 fail

**Step 3: Commit**

```bash
git add libraries/config/__tests__/generators/tsconfig.test.ts
git commit -m "test(config): add tests for generateTSConfig"
```

---

### Task 6: Update README to match actual API

The README shows incorrect function signatures. For example, `generatePackageJson` is shown as taking `{ name, version, description }` but actually takes `(libraryName, version, config, customDependencies?)`. The generators section also shows them as standalone calls without the `config` parameter.

**Files:**
- Modify: `libraries/config/README.md`

**Step 1: Update the README**

Key corrections needed:

1. **Generator usage examples** — All generators take a `ResolvedFotConfig` as their first (or only) argument. Show correct signatures.
2. **`generatePackageJson` signature** — Show `(libraryName, version, config, customDependencies?)`.
3. **API Reference section** — Update generator signatures to match actual code.
4. **`ResolvedFotConfig` type** — Add `isolatedDeclarations` and `maxMemory` fields.
5. **`TypeScriptOptions` type** — Add `isolatedDeclarations` and `maxMemory` fields.

The full corrected README should reflect the actual function signatures from:
- `src/generators/biome.ts:48` — `generateBiomeConfig(config: ResolvedFotConfig): BiomeConfig`
- `src/generators/package-json.ts:40` — `generatePackageJson(libraryName, version, config, customDependencies?): PackageJson`
- `src/generators/tsconfig.ts:36` — `generateTSConfig(config: ResolvedFotConfig): TSConfig`

**Step 2: Verify accuracy by comparing README against source files**

Manually confirm each function signature and type definition matches the source.

**Step 3: Commit**

```bash
git add libraries/config/README.md
git commit -m "docs(config): update README to match actual API signatures"
```

---

### Task 7: Update CHANGELOG and bump to 1.0.0

**Files:**
- Modify: `libraries/config/CHANGELOG.md`
- Modify: `libraries/config/package.json` (version field only)

**Step 1: Update CHANGELOG.md**

Replace the current contents with:

```markdown
# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

## [1.0.0] - 2026-02-02

### Fixed
- `ResolvedFotConfig` type now correctly types `maxMemory` as optional
- Plugin export paths in `generatePackageJson` use correct subdirectory pattern (`plugins/<name>/index.js`)

### Changed
- Stabilized all public APIs for 1.0.0 release

### Added
- Tests for `generateBiomeConfig` generator
- Tests for `generateTSConfig` generator

## [0.1.0]

### Added
- `defineFotConfig()` factory function for FOT library configuration validation
- Config schema and types for build formats (ESM/CJS), external dependencies, TypeScript options, Biome options, and plugins
- `generateBiomeConfig()` for biome.json configuration generation
- `generatePackageJson()` for package.json generation with proper exports
- `generateTSConfig()` for tsconfig.json generation with TypeScript compiler options
- Zod-based configuration validation

[Unreleased]: https://github.com/F-O-T/libraries/compare/@f-o-t/config@1.0.0...HEAD
[1.0.0]: https://github.com/F-O-T/libraries/compare/@f-o-t/config@0.1.0...@f-o-t/config@1.0.0
[0.1.0]: https://github.com/F-O-T/libraries/releases/tag/@f-o-t/config@0.1.0
```

**Step 2: Bump version in package.json**

Change `"version": "0.1.0"` to `"version": "1.0.0"` in `libraries/config/package.json`.

**Step 3: Run all tests one final time**

Run: `cd /home/yorizel/Documents/fot-libraries/libraries/config && bun test`
Expected: All tests pass, 0 failures

**Step 4: Run typecheck one final time**

Run: `cd /home/yorizel/Documents/fot-libraries/libraries/config && bunx tsc --noEmit`
Expected: No errors

**Step 5: Commit**

```bash
git add libraries/config/CHANGELOG.md libraries/config/package.json
git commit -m "chore(config): release version 1.0.0"
```

---

## Execution Order

Tasks 1-3 must be done sequentially (type fix -> test fix -> test type fix).
Tasks 4-5 are independent and can be done in parallel after Task 3.
Task 6 is independent and can be done in parallel with Tasks 4-5.
Task 7 must be done last.

```
Task 1 (type fix) → Task 2 (test fix) → Task 3 (test types)
                                              ├→ Task 4 (biome tests)
                                              ├→ Task 5 (tsconfig tests)
                                              └→ Task 6 (README)
                                                     └→ Task 7 (changelog + version bump)
```
