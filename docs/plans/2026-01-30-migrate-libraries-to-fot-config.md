# Migrate All Libraries to @f-o-t/config Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Migrate all 13 unmigrated libraries from bunup to the standardized @f-o-t/config + @f-o-t/cli build system.

**Architecture:** Each library gets a `fot.config.ts` defining externals and plugins. Scripts switch to `fot build/test/lint/format`. Sub-exports are restructured into `src/plugins/{name}/index.ts` convention. `bunup.config.ts` is deleted. `tsconfig.json` and `biome.json` are regenerated by `fot build`/`fot generate`. `package.json` is manually edited to preserve version/description/dependencies while switching scripts and devDependencies.

**Tech Stack:** Bun, @f-o-t/cli, @f-o-t/config, zod 4.3.6

**BREAKING CHANGE:** Libraries with sub-exports (xml, digital-certificate, spelling, money, pdf, content-analysis) will have their export paths changed from `./foo` to `./plugins/foo`.

---

## Important Notes

- **`fot generate` is destructive** — it resets version to `0.1.0` and drops dependencies. Do NOT run it. Edit `package.json` manually.
- **`fot build` regenerates `tsconfig.json`** automatically — no need to touch it.
- **All zod versions must be `^4.3.6`**.
- **devDependencies should only be `@f-o-t/cli` and `@f-o-t/config`** as `workspace:*`. Remove `bunup`, `bumpp`, `@biomejs/biome`, `@types/bun`, `typescript` (these are handled by the CLI now).
- **workspace deps** like `@f-o-t/condition-evaluator` should use `workspace:*` (not pinned versions).

---

## Migration Template (for reference, not a task)

For every library, the steps are:

1. Create `fot.config.ts` with `defineFotConfig({ external: [...], plugins: [...] })`
2. Delete `bunup.config.ts`
3. Edit `package.json`:
   - Scripts → `{ "build": "fot build", "test": "fot test", "lint": "fot lint", "format": "fot format" }`
   - devDependencies → `{ "@f-o-t/cli": "workspace:*", "@f-o-t/config": "workspace:*" }`
   - Update zod to `^4.3.6` in dependencies
   - Update workspace deps to `workspace:*`
   - Update exports to use `./plugins/{name}` convention for sub-exports
   - Remove: `main`, `module`, `files`, `peerDependencies`, `peerDependenciesMeta`, `publishConfig`, `bugs`, `homepage`, `./package.json` export, `bun` and `require` conditions in exports
4. If library has sub-exports: move files into `src/plugins/{name}/index.ts`, update internal imports
5. Run `bun run build` — verify it passes
6. Run `bun run test` — verify all tests pass
7. Commit

---

## Tier 1: Simple Libraries (no sub-exports)

These only export `.` and need no file restructuring.

---

### Task 1: Migrate csv

**Files:**
- Create: `libraries/csv/fot.config.ts`
- Delete: `libraries/csv/bunup.config.ts`
- Modify: `libraries/csv/package.json`

**Step 1: Create fot.config.ts**

```ts
import { defineFotConfig } from '@f-o-t/config';

export default defineFotConfig({
  external: ['zod'],
});
```

**Step 2: Delete bunup.config.ts**

```bash
rm libraries/csv/bunup.config.ts
```

**Step 3: Edit package.json**

Replace the full package.json with:

```json
{
  "name": "@f-o-t/csv",
  "version": "1.2.1",
  "description": "RFC 4180 compliant CSV parser with streaming support",
  "type": "module",
  "main": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "default": "./dist/index.js"
    }
  },
  "scripts": {
    "build": "fot build",
    "test": "fot test",
    "lint": "fot lint",
    "format": "fot format"
  },
  "dependencies": {
    "zod": "^4.3.6"
  },
  "devDependencies": {
    "@f-o-t/cli": "workspace:*",
    "@f-o-t/config": "workspace:*"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/F-O-T/libraries.git",
    "directory": "libraries/csv"
  }
}
```

**Step 4: Build and test**

```bash
cd libraries/csv && bun run build && bun run test
```

**Step 5: Commit**

```bash
git add libraries/csv
git commit -m "feat(csv): migrate to @f-o-t/config build system"
```

---

### Task 2: Migrate markdown

**Files:**
- Create: `libraries/markdown/fot.config.ts`
- Delete: `libraries/markdown/bunup.config.ts`
- Modify: `libraries/markdown/package.json`

**Step 1: Create fot.config.ts**

```ts
import { defineFotConfig } from '@f-o-t/config';

export default defineFotConfig({
  external: ['zod'],
});
```

**Step 2: Delete bunup.config.ts**

```bash
rm libraries/markdown/bunup.config.ts
```

**Step 3: Edit package.json**

```json
{
  "name": "@f-o-t/markdown",
  "version": "1.0.2",
  "description": "CommonMark compliant markdown parser with AST generation and streaming support",
  "type": "module",
  "main": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "default": "./dist/index.js"
    }
  },
  "scripts": {
    "build": "fot build",
    "test": "fot test",
    "lint": "fot lint",
    "format": "fot format"
  },
  "dependencies": {
    "zod": "^4.3.6"
  },
  "devDependencies": {
    "@f-o-t/cli": "workspace:*",
    "@f-o-t/config": "workspace:*"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/F-O-T/libraries.git",
    "directory": "libraries/markdown"
  }
}
```

**Step 4: Build and test**

```bash
cd libraries/markdown && bun run build && bun run test
```

**Step 5: Commit**

```bash
git add libraries/markdown
git commit -m "feat(markdown): migrate to @f-o-t/config build system"
```

---

### Task 3: Migrate ofx

**Files:**
- Create: `libraries/ofx/fot.config.ts`
- Delete: `libraries/ofx/bunup.config.ts`
- Modify: `libraries/ofx/package.json`

**Step 1: Create fot.config.ts**

```ts
import { defineFotConfig } from '@f-o-t/config';

export default defineFotConfig({
  external: ['zod'],
});
```

**Step 2: Delete bunup.config.ts**

```bash
rm libraries/ofx/bunup.config.ts
```

**Step 3: Edit package.json**

```json
{
  "name": "@f-o-t/ofx",
  "version": "2.4.1",
  "description": "Typesafe ofx handling",
  "type": "module",
  "main": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "default": "./dist/index.js"
    }
  },
  "scripts": {
    "build": "fot build",
    "test": "fot test",
    "lint": "fot lint",
    "format": "fot format"
  },
  "dependencies": {
    "zod": "^4.3.6"
  },
  "devDependencies": {
    "@f-o-t/cli": "workspace:*",
    "@f-o-t/config": "workspace:*"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/F-O-T/libraries.git",
    "directory": "libraries/ofx"
  }
}
```

**Step 4: Build and test**

```bash
cd libraries/ofx && bun run build && bun run test
```

**Step 5: Commit**

```bash
git add libraries/ofx
git commit -m "feat(ofx): migrate to @f-o-t/config build system"
```

---

### Task 4: Migrate condition-evaluator

**Files:**
- Create: `libraries/condition-evaluator/fot.config.ts`
- Delete: `libraries/condition-evaluator/bunup.config.ts`
- Modify: `libraries/condition-evaluator/package.json`

**Step 1: Create fot.config.ts**

```ts
import { defineFotConfig } from '@f-o-t/config';

export default defineFotConfig({
  external: ['zod'],
});
```

**Step 2: Delete bunup.config.ts**

```bash
rm libraries/condition-evaluator/bunup.config.ts
```

**Step 3: Edit package.json**

```json
{
  "name": "@f-o-t/condition-evaluator",
  "version": "2.0.1",
  "description": "A flexible, typesafe condition evaluator for building rule engines",
  "type": "module",
  "main": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "default": "./dist/index.js"
    }
  },
  "scripts": {
    "build": "fot build",
    "test": "fot test",
    "lint": "fot lint",
    "format": "fot format"
  },
  "dependencies": {
    "zod": "^4.3.6"
  },
  "devDependencies": {
    "@f-o-t/cli": "workspace:*",
    "@f-o-t/config": "workspace:*"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/F-O-T/libraries.git",
    "directory": "libraries/condition-evaluator"
  }
}
```

**Step 4: Build and test**

```bash
cd libraries/condition-evaluator && bun run build && bun run test
```

**Step 5: Commit**

```bash
git add libraries/condition-evaluator
git commit -m "feat(condition-evaluator): migrate to @f-o-t/config build system"
```

---

### Task 5: Migrate rules-engine

**Files:**
- Create: `libraries/rules-engine/fot.config.ts`
- Delete: `libraries/rules-engine/bunup.config.ts`
- Modify: `libraries/rules-engine/package.json`

**Step 1: Create fot.config.ts**

```ts
import { defineFotConfig } from '@f-o-t/config';

export default defineFotConfig({
  external: ['zod', '@f-o-t/condition-evaluator'],
});
```

**Step 2: Delete bunup.config.ts**

```bash
rm libraries/rules-engine/bunup.config.ts
```

**Step 3: Edit package.json**

```json
{
  "name": "@f-o-t/rules-engine",
  "version": "2.0.2",
  "description": "Type-safe, functional rules orchestration engine for TypeScript",
  "type": "module",
  "main": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "default": "./dist/index.js"
    }
  },
  "scripts": {
    "build": "fot build",
    "test": "fot test",
    "lint": "fot lint",
    "format": "fot format"
  },
  "dependencies": {
    "@f-o-t/condition-evaluator": "workspace:*",
    "zod": "^4.3.6"
  },
  "devDependencies": {
    "@f-o-t/cli": "workspace:*",
    "@f-o-t/config": "workspace:*"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/F-O-T/libraries.git",
    "directory": "libraries/rules-engine"
  }
}
```

**Step 4: Build and test**

```bash
cd libraries/rules-engine && bun run build && bun run test
```

**Step 5: Commit**

```bash
git add libraries/rules-engine
git commit -m "feat(rules-engine): migrate to @f-o-t/config build system"
```

---

### Task 6: Migrate tax-calculator

**Files:**
- Create: `libraries/tax-calculator/fot.config.ts`
- Delete: `libraries/tax-calculator/bunup.config.ts`
- Modify: `libraries/tax-calculator/package.json`

**Step 1: Create fot.config.ts**

```ts
import { defineFotConfig } from '@f-o-t/config';

export default defineFotConfig({
  external: ['zod', '@f-o-t/condition-evaluator', '@f-o-t/money', '@f-o-t/rules-engine'],
});
```

**Step 2: Delete bunup.config.ts**

```bash
rm libraries/tax-calculator/bunup.config.ts
```

**Step 3: Edit package.json**

```json
{
  "name": "@f-o-t/tax-calculator",
  "version": "0.1.0",
  "description": "Brazilian tax calculation library with support for ICMS, IPI, PIS, COFINS, ISS, and more",
  "type": "module",
  "main": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "default": "./dist/index.js"
    }
  },
  "scripts": {
    "build": "fot build",
    "test": "fot test",
    "lint": "fot lint",
    "format": "fot format"
  },
  "dependencies": {
    "@f-o-t/condition-evaluator": "workspace:*",
    "@f-o-t/money": "workspace:*",
    "@f-o-t/rules-engine": "workspace:*",
    "zod": "^4.3.6"
  },
  "devDependencies": {
    "@f-o-t/cli": "workspace:*",
    "@f-o-t/config": "workspace:*"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/F-O-T/libraries.git",
    "directory": "libraries/tax-calculator"
  }
}
```

**Step 4: Build and test**

```bash
cd libraries/tax-calculator && bun run build && bun run test
```

**Step 5: Commit**

```bash
git add libraries/tax-calculator
git commit -m "feat(tax-calculator): migrate to @f-o-t/config build system"
```

---

### Task 7: Migrate uom

**Files:**
- Create: `libraries/uom/fot.config.ts`
- Delete: `libraries/uom/bunup.config.ts`
- Modify: `libraries/uom/package.json`

**Step 1: Create fot.config.ts**

```ts
import { defineFotConfig } from '@f-o-t/config';

export default defineFotConfig({
  external: ['zod'],
});
```

**Step 2: Delete bunup.config.ts**

```bash
rm libraries/uom/bunup.config.ts
```

**Step 3: Edit package.json**

```json
{
  "name": "@f-o-t/uom",
  "version": "0.1.0",
  "description": "Type-safe units of measurement library with BigInt precision",
  "type": "module",
  "main": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "default": "./dist/index.js"
    }
  },
  "scripts": {
    "build": "fot build",
    "test": "fot test",
    "lint": "fot lint",
    "format": "fot format"
  },
  "dependencies": {
    "zod": "^4.3.6"
  },
  "devDependencies": {
    "@f-o-t/cli": "workspace:*",
    "@f-o-t/config": "workspace:*"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/F-O-T/libraries.git",
    "directory": "libraries/uom"
  }
}
```

**Step 4: Build and test**

```bash
cd libraries/uom && bun run build && bun run test
```

**Step 5: Commit**

```bash
git add libraries/uom
git commit -m "feat(uom): migrate to @f-o-t/config build system"
```

---

## Tier 2: Libraries with Sub-Exports (breaking restructure to plugins convention)

These libraries have sub-exports that need to be moved into `src/plugins/{name}/index.ts`. Export paths change from `./foo` to `./plugins/foo`.

---

### Task 8: Migrate xml (sub-exports: stream, xpath, canonicalize)

**Files:**
- Create: `libraries/xml/fot.config.ts`
- Delete: `libraries/xml/bunup.config.ts`
- Move: `libraries/xml/src/stream-parser.ts` → `libraries/xml/src/plugins/stream/index.ts`
- Move: `libraries/xml/src/xpath.ts` → `libraries/xml/src/plugins/xpath/index.ts`
- Move: `libraries/xml/src/canonicalize.ts` → `libraries/xml/src/plugins/canonicalize/index.ts`
- Modify: `libraries/xml/package.json`
- Modify: any files that import the moved files with relative paths

**Step 1: Create plugin directories and move files**

```bash
cd libraries/xml
mkdir -p src/plugins/stream src/plugins/xpath src/plugins/canonicalize
mv src/stream-parser.ts src/plugins/stream/index.ts
mv src/xpath.ts src/plugins/xpath/index.ts
mv src/canonicalize.ts src/plugins/canonicalize/index.ts
```

**Step 2: Fix internal imports**

Search for any relative imports to the old paths across the xml library source and tests. Update them:
- `./stream-parser` or `../stream-parser` → `./plugins/stream` or `../plugins/stream`
- `./xpath` or `../xpath` → `./plugins/xpath` or `../plugins/xpath`
- `./canonicalize` or `../canonicalize` → `./plugins/canonicalize` or `../plugins/canonicalize`

Run: `grep -r "stream-parser\|xpath\|canonicalize" libraries/xml/src/ --include="*.ts"` to find all references.

**Step 3: Create fot.config.ts**

```ts
import { defineFotConfig } from '@f-o-t/config';

export default defineFotConfig({
  external: ['zod'],
  plugins: ['stream', 'xpath', 'canonicalize'],
});
```

**Step 4: Delete bunup.config.ts**

```bash
rm libraries/xml/bunup.config.ts
```

**Step 5: Edit package.json**

```json
{
  "name": "@f-o-t/xml",
  "version": "1.0.0",
  "description": "Zero-dependency XML library with DOM parser, streaming SAX parser, serializer, XPath queries, and W3C Exclusive C14N canonicalization",
  "type": "module",
  "main": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "default": "./dist/index.js"
    },
    "./plugins/stream": {
      "types": "./dist/plugins/stream/index.d.ts",
      "default": "./dist/plugins/stream/index.js"
    },
    "./plugins/xpath": {
      "types": "./dist/plugins/xpath/index.d.ts",
      "default": "./dist/plugins/xpath/index.js"
    },
    "./plugins/canonicalize": {
      "types": "./dist/plugins/canonicalize/index.d.ts",
      "default": "./dist/plugins/canonicalize/index.js"
    }
  },
  "scripts": {
    "build": "fot build",
    "test": "fot test",
    "lint": "fot lint",
    "format": "fot format"
  },
  "dependencies": {
    "zod": "^4.3.6"
  },
  "devDependencies": {
    "@f-o-t/cli": "workspace:*",
    "@f-o-t/config": "workspace:*"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/F-O-T/libraries.git",
    "directory": "libraries/xml"
  }
}
```

**Step 6: Build and test**

```bash
cd libraries/xml && bun run build && bun run test
```

**Step 7: Fix any downstream consumers**

Check if `digital-certificate` imports from `@f-o-t/xml/stream`, `@f-o-t/xml/xpath`, or `@f-o-t/xml/canonicalize` and update to `@f-o-t/xml/plugins/stream` etc.

```bash
grep -r "@f-o-t/xml/" libraries/ --include="*.ts" | grep -v node_modules | grep -v dist
```

**Step 8: Commit**

```bash
git add libraries/xml
git commit -m "feat(xml)!: migrate to @f-o-t/config, restructure sub-exports to plugins"
```

---

### Task 9: Migrate digital-certificate (sub-exports: xml-signer, mtls)

**Files:**
- Create: `libraries/digital-certificate/fot.config.ts`
- Delete: `libraries/digital-certificate/bunup.config.ts`
- Move: `libraries/digital-certificate/src/xml-signer.ts` → `libraries/digital-certificate/src/plugins/xml-signer/index.ts`
- Move: `libraries/digital-certificate/src/mtls.ts` → `libraries/digital-certificate/src/plugins/mtls/index.ts`
- Modify: `libraries/digital-certificate/package.json`

**Step 1: Create plugin directories and move files**

```bash
cd libraries/digital-certificate
mkdir -p src/plugins/xml-signer src/plugins/mtls
mv src/xml-signer.ts src/plugins/xml-signer/index.ts
mv src/mtls.ts src/plugins/mtls/index.ts
```

**Step 2: Fix internal imports**

Search and update relative imports:
- `./xml-signer` → `./plugins/xml-signer`
- `./mtls` → `./plugins/mtls`

```bash
grep -r "xml-signer\|mtls" libraries/digital-certificate/src/ --include="*.ts"
```

**Step 3: Create fot.config.ts**

```ts
import { defineFotConfig } from '@f-o-t/config';

export default defineFotConfig({
  external: ['zod', '@f-o-t/xml'],
  plugins: ['xml-signer', 'mtls'],
});
```

**Step 4: Delete bunup.config.ts**

```bash
rm libraries/digital-certificate/bunup.config.ts
```

**Step 5: Edit package.json**

```json
{
  "name": "@f-o-t/digital-certificate",
  "version": "1.0.0",
  "description": "Brazilian A1 digital certificate handling with .pfx/.p12 parsing, XML-DSig signing, certificate management, and mTLS support",
  "type": "module",
  "main": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "default": "./dist/index.js"
    },
    "./plugins/xml-signer": {
      "types": "./dist/plugins/xml-signer/index.d.ts",
      "default": "./dist/plugins/xml-signer/index.js"
    },
    "./plugins/mtls": {
      "types": "./dist/plugins/mtls/index.d.ts",
      "default": "./dist/plugins/mtls/index.js"
    }
  },
  "scripts": {
    "build": "fot build",
    "test": "fot test",
    "lint": "fot lint",
    "format": "fot format"
  },
  "dependencies": {
    "@f-o-t/xml": "workspace:*",
    "zod": "^4.3.6"
  },
  "devDependencies": {
    "@f-o-t/cli": "workspace:*",
    "@f-o-t/config": "workspace:*"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/F-O-T/libraries.git",
    "directory": "libraries/digital-certificate"
  }
}
```

**Step 6: Build and test**

```bash
cd libraries/digital-certificate && bun run build && bun run test
```

**Step 7: Fix downstream consumers**

Check if `pdf` imports from `@f-o-t/digital-certificate/xml-signer` or `@f-o-t/digital-certificate/mtls` and update.

```bash
grep -r "@f-o-t/digital-certificate/" libraries/ --include="*.ts" | grep -v node_modules | grep -v dist
```

**Step 8: Commit**

```bash
git add libraries/digital-certificate
git commit -m "feat(digital-certificate)!: migrate to @f-o-t/config, restructure sub-exports to plugins"
```

---

### Task 10: Migrate spelling (sub-export: browser-storage)

**Files:**
- Create: `libraries/spelling/fot.config.ts`
- Delete: `libraries/spelling/bunup.config.ts`
- Move: `libraries/spelling/src/browser-storage.ts` → `libraries/spelling/src/plugins/browser-storage/index.ts`
- Modify: `libraries/spelling/package.json`

**Step 1: Create plugin directory and move file**

```bash
cd libraries/spelling
mkdir -p src/plugins/browser-storage
mv src/browser-storage.ts src/plugins/browser-storage/index.ts
```

**Step 2: Fix internal imports**

```bash
grep -r "browser-storage" libraries/spelling/src/ --include="*.ts"
```

**Step 3: Create fot.config.ts**

```ts
import { defineFotConfig } from '@f-o-t/config';

export default defineFotConfig({
  external: ['zod'],
  plugins: ['browser-storage'],
});
```

**Step 4: Delete bunup.config.ts**

```bash
rm libraries/spelling/bunup.config.ts
```

**Step 5: Edit package.json**

```json
{
  "name": "@f-o-t/spelling",
  "version": "1.0.1",
  "description": "Hunspell-compatible spell checking library with Zod schemas",
  "type": "module",
  "main": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "default": "./dist/index.js"
    },
    "./plugins/browser-storage": {
      "types": "./dist/plugins/browser-storage/index.d.ts",
      "default": "./dist/plugins/browser-storage/index.js"
    }
  },
  "scripts": {
    "build": "fot build",
    "test": "fot test",
    "lint": "fot lint",
    "format": "fot format"
  },
  "dependencies": {
    "zod": "^4.3.6"
  },
  "devDependencies": {
    "@f-o-t/cli": "workspace:*",
    "@f-o-t/config": "workspace:*"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/F-O-T/libraries.git",
    "directory": "libraries/spelling"
  }
}
```

**Step 6: Build and test**

```bash
cd libraries/spelling && bun run build && bun run test
```

**Step 7: Commit**

```bash
git add libraries/spelling
git commit -m "feat(spelling)!: migrate to @f-o-t/config, restructure sub-exports to plugins"
```

---

### Task 11: Migrate money (sub-export: operators)

**Files:**
- Create: `libraries/money/fot.config.ts`
- Delete: `libraries/money/bunup.config.ts`
- Move: `libraries/money/src/operators/` → `libraries/money/src/plugins/operators/`
- Modify: `libraries/money/package.json`

**Step 1: Move operators directory to plugins**

```bash
cd libraries/money
mkdir -p src/plugins
mv src/operators src/plugins/operators
```

**Step 2: Fix internal imports**

Update any relative imports referencing `./operators` or `../operators`:

```bash
grep -r "operators" libraries/money/src/ --include="*.ts"
```

**Step 3: Create fot.config.ts**

```ts
import { defineFotConfig } from '@f-o-t/config';

export default defineFotConfig({
  external: ['zod', '@f-o-t/condition-evaluator'],
  plugins: ['operators'],
});
```

**Step 4: Delete bunup.config.ts**

```bash
rm libraries/money/bunup.config.ts
```

**Step 5: Edit package.json**

```json
{
  "name": "@f-o-t/money",
  "version": "1.1.1",
  "description": "Type-safe money handling library with BigInt precision and ISO 4217 currency support",
  "type": "module",
  "main": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "default": "./dist/index.js"
    },
    "./plugins/operators": {
      "types": "./dist/plugins/operators/index.d.ts",
      "default": "./dist/plugins/operators/index.js"
    }
  },
  "scripts": {
    "build": "fot build",
    "test": "fot test",
    "lint": "fot lint",
    "format": "fot format"
  },
  "dependencies": {
    "@f-o-t/condition-evaluator": "workspace:*",
    "zod": "^4.3.6"
  },
  "devDependencies": {
    "@f-o-t/cli": "workspace:*",
    "@f-o-t/config": "workspace:*"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/F-O-T/libraries.git",
    "directory": "libraries/money"
  }
}
```

**Step 6: Build and test**

```bash
cd libraries/money && bun run build && bun run test
```

**Step 7: Fix downstream consumers**

```bash
grep -r "@f-o-t/money/operators" libraries/ --include="*.ts" | grep -v node_modules | grep -v dist
```

Update any hits to `@f-o-t/money/plugins/operators`.

**Step 8: Commit**

```bash
git add libraries/money
git commit -m "feat(money)!: migrate to @f-o-t/config, restructure sub-exports to plugins"
```

---

### Task 12: Migrate pdf (sub-exports: generation, parsing, signing)

**Files:**
- Create: `libraries/pdf/fot.config.ts`
- Delete: `libraries/pdf/bunup.config.ts`
- Move: `libraries/pdf/src/generation/` → `libraries/pdf/src/plugins/generation/`
- Move: `libraries/pdf/src/parsing/` → `libraries/pdf/src/plugins/parsing/`
- Move: `libraries/pdf/src/signing/` → `libraries/pdf/src/plugins/signing/`
- Modify: `libraries/pdf/package.json`

**Step 1: Move directories to plugins**

```bash
cd libraries/pdf
mkdir -p src/plugins
mv src/generation src/plugins/generation
mv src/parsing src/plugins/parsing
mv src/signing src/plugins/signing
```

**Step 2: Fix internal imports**

```bash
grep -rn "generation\|parsing\|signing" libraries/pdf/src/ --include="*.ts"
```

Update relative import paths (e.g., `../generation` → `../plugins/generation`).

**Step 3: Create fot.config.ts**

```ts
import { defineFotConfig } from '@f-o-t/config';

export default defineFotConfig({
  external: ['zod', '@f-o-t/digital-certificate'],
  plugins: ['generation', 'parsing', 'signing'],
});
```

**Step 4: Delete bunup.config.ts**

```bash
rm libraries/pdf/bunup.config.ts
```

**Step 5: Edit package.json**

```json
{
  "name": "@f-o-t/pdf",
  "version": "0.1.0",
  "description": "Comprehensive PDF 1.7 library with generation, parsing, and digital signatures",
  "type": "module",
  "main": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "default": "./dist/index.js"
    },
    "./plugins/generation": {
      "types": "./dist/plugins/generation/index.d.ts",
      "default": "./dist/plugins/generation/index.js"
    },
    "./plugins/parsing": {
      "types": "./dist/plugins/parsing/index.d.ts",
      "default": "./dist/plugins/parsing/index.js"
    },
    "./plugins/signing": {
      "types": "./dist/plugins/signing/index.d.ts",
      "default": "./dist/plugins/signing/index.js"
    }
  },
  "scripts": {
    "build": "fot build",
    "test": "fot test",
    "lint": "fot lint",
    "format": "fot format"
  },
  "dependencies": {
    "@f-o-t/digital-certificate": "workspace:*",
    "zod": "^4.3.6"
  },
  "devDependencies": {
    "@f-o-t/cli": "workspace:*",
    "@f-o-t/config": "workspace:*"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/F-O-T/libraries.git",
    "directory": "libraries/pdf"
  }
}
```

**Step 6: Build and test**

```bash
cd libraries/pdf && bun run build && bun run test
```

**Step 7: Commit**

```bash
git add libraries/pdf
git commit -m "feat(pdf)!: migrate to @f-o-t/config, restructure sub-exports to plugins"
```

---

### Task 13: Migrate content-analysis (sub-export: types)

**Files:**
- Create: `libraries/content-analysis/fot.config.ts`
- Delete: `libraries/content-analysis/bunup.config.ts`
- Move: `libraries/content-analysis/src/types.ts` → `libraries/content-analysis/src/plugins/types/index.ts`
- Modify: `libraries/content-analysis/package.json`

**Step 1: Create plugin directory and move file**

```bash
cd libraries/content-analysis
mkdir -p src/plugins/types
mv src/types.ts src/plugins/types/index.ts
```

**Step 2: Fix internal imports**

```bash
grep -r "types" libraries/content-analysis/src/ --include="*.ts"
```

Update relative imports from `./types` to `./plugins/types`.

**Step 3: Create fot.config.ts**

```ts
import { defineFotConfig } from '@f-o-t/config';

export default defineFotConfig({
  external: ['@f-o-t/markdown'],
  plugins: ['types'],
});
```

**Step 4: Delete bunup.config.ts**

```bash
rm libraries/content-analysis/bunup.config.ts
```

**Step 5: Edit package.json**

```json
{
  "name": "@f-o-t/content-analysis",
  "version": "1.0.2",
  "description": "Content analysis library for SEO, readability, structure, and pattern detection",
  "type": "module",
  "main": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "default": "./dist/index.js"
    },
    "./plugins/types": {
      "types": "./dist/plugins/types/index.d.ts",
      "default": "./dist/plugins/types/index.js"
    }
  },
  "scripts": {
    "build": "fot build",
    "test": "fot test",
    "lint": "fot lint",
    "format": "fot format"
  },
  "dependencies": {
    "@f-o-t/markdown": "workspace:*"
  },
  "devDependencies": {
    "@f-o-t/cli": "workspace:*",
    "@f-o-t/config": "workspace:*"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/F-O-T/libraries.git",
    "directory": "libraries/content-analysis"
  }
}
```

**Step 6: Build and test**

```bash
cd libraries/content-analysis && bun run build && bun run test
```

**Step 7: Commit**

```bash
git add libraries/content-analysis
git commit -m "feat(content-analysis)!: migrate to @f-o-t/config, restructure sub-exports to plugins"
```

---

## Task 14: Final Verification

**Step 1: Install all dependencies**

```bash
cd /home/yorizel/Documents/fot-libraries && bun install
```

**Step 2: Build all libraries**

```bash
bun run build
```

**Step 3: Test all libraries**

```bash
bun run test
```

**Step 4: Verify no bunup references remain**

```bash
grep -r "bunup" libraries/ --include="*.ts" --include="*.json" | grep -v node_modules | grep -v dist | grep -v bun.lock
```

Expected: No matches (or only in `config`/`cli` if they reference it for backwards compat).

**Step 5: Commit any remaining fixes**

```bash
git add -A && git commit -m "chore: final cleanup after full migration to @f-o-t/config"
```
